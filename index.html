<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üéÑ Secret Santa Addresses</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
@keyframes gentleFloat {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-8px); }
}

@keyframes subtleGlow {
  0%, 100% { opacity: 0.4; }
  50% { opacity: 0.7; }
}

@keyframes snowDrift {
  0% { transform: translateY(-10px) translateX(0) rotate(0deg); opacity: 0; }
  10% { opacity: 0.8; }
  90% { opacity: 0.8; }
  100% { transform: translateY(100vh) translateX(30px) rotate(180deg); opacity: 0; }
}

@keyframes shimmer {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', system-ui, sans-serif;
  background: linear-gradient(135deg, #0f3d20 0%, #1a5c32 50%, #0f3d20 100%);
  color: #1f1f1f;
  min-height: 100vh;
  padding: 40px 20px;
  position: relative;
  overflow-x: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
}

body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: radial-gradient(ellipse at top, rgba(255,255,255,0.05) 0%, transparent 60%);
  pointer-events: none;
}

.snowflake {
  position: fixed;
  top: -10px;
  color: rgba(255, 255, 255, 0.6);
  font-size: 14px;
  animation: snowDrift linear infinite;
  pointer-events: none;
  z-index: 1;
  filter: blur(0.5px);
}

.container {
  max-width: 900px;
  width: 100%;
  position: relative;
  z-index: 10;
}

.header-section {
  position: relative;
  margin-bottom: 32px;
  text-align: center;
}

.santa-container {
  display: inline-block;
  animation: gentleFloat 4s ease-in-out infinite;
  margin-bottom: 16px;
}

.santa {
  width: 100px;
  height: 100px;
  filter: drop-shadow(0 8px 16px rgba(0,0,0,0.2));
}

.title-box {
  background: linear-gradient(135deg, rgba(196, 30, 58, 0.95) 0%, rgba(139, 0, 0, 0.95) 100%);
  backdrop-filter: blur(20px);
  padding: 32px;
  border-radius: 24px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3), 0 0 0 1px rgba(255,215,0,0.2);
  position: relative;
  overflow: hidden;
}

.title-box::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 200%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
  animation: shimmer 8s infinite;
}

.lights-container {
  position: absolute;
  top: 12px;
  right: 12px;
  display: flex;
  gap: 6px;
}

.light {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  animation: subtleGlow 2s infinite;
  box-shadow: 0 0 10px currentColor;
}

.light:nth-child(1) { background: #ff4444; animation-delay: 0s; }
.light:nth-child(2) { background: #44ff44; animation-delay: 0.5s; }
.light:nth-child(3) { background: #ffff44; animation-delay: 1s; }
.light:nth-child(4) { background: #4444ff; animation-delay: 1.5s; }

h1 {
  font-size: 32px;
  margin-bottom: 8px;
  color: white;
  font-weight: 700;
  letter-spacing: -0.5px;
  text-shadow: 0 2px 20px rgba(0,0,0,0.3);
}

.subtitle {
  font-size: 15px;
  color: rgba(255,255,255,0.9);
  font-weight: 400;
}

.locked-banner {
  background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
  color: white;
  padding: 16px;
  border-radius: 16px;
  margin-bottom: 20px;
  text-align: center;
  font-weight: 600;
  box-shadow: 0 8px 24px rgba(255,107,107,0.3);
  display: none;
}

.locked-banner.active {
  display: block;
}

.card {
  background: rgba(255, 255, 255, 0.98);
  backdrop-filter: blur(20px);
  border-radius: 24px;
  padding: 32px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.2), 0 0 0 1px rgba(0,0,0,0.05);
}

.table-container {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  border-radius: 16px;
  margin-bottom: 24px;
}

table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  background: white;
  border-radius: 16px;
  overflow: hidden;
}

thead {
  position: sticky;
  top: 0;
  z-index: 10;
}

th {
  background: linear-gradient(135deg, #2f6f4e 0%, #1a4731 100%);
  color: white;
  font-weight: 600;
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  padding: 16px;
  text-align: left;
  border-bottom: 2px solid #ffd700;
}

th:first-child { width: 20%; min-width: 120px; border-top-left-radius: 16px; }
th:nth-child(2) { width: 50%; min-width: 200px; }
th:last-child { width: 30%; min-width: 140px; border-top-right-radius: 16px; }

tr {
  transition: all 0.2s ease;
  position: relative;
}

tbody tr:hover {
  background: #f8f9fa;
}

tbody tr:hover .delete-btn {
  opacity: 1;
  pointer-events: auto;
}

td {
  padding: 16px;
  border-bottom: 1px solid #f0f0f0;
  color: #1f1f1f;
  vertical-align: top;
  word-wrap: break-word;
  word-break: break-word;
  white-space: pre-wrap;
  transition: all 0.2s ease;
  position: relative;
}

td[contenteditable="true"] {
  cursor: text;
  outline: none;
}

td[contenteditable="true"]:focus {
  background: #fffef5;
  box-shadow: inset 0 0 0 2px #2f6f4e;
  border-radius: 8px;
}

td[contenteditable="false"] {
  cursor: not-allowed;
  opacity: 0.6;
}

td:first-child { width: 20%; min-width: 120px; }
td:nth-child(2) { width: 50%; min-width: 200px; }
td:last-child { width: 30%; min-width: 140px; padding-right: 60px; }

tbody tr:last-child td {
  border-bottom: none;
}

.delete-btn {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
  color: white;
  border: none;
  width: 32px;
  height: 32px;
  border-radius: 8px;
  cursor: pointer;
  opacity: 0;
  pointer-events: none;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  box-shadow: 0 4px 12px rgba(255,107,107,0.3);
}

.delete-btn:hover {
  transform: translateY(-50%) scale(1.1);
  box-shadow: 0 6px 16px rgba(255,107,107,0.4);
}

.delete-btn:active {
  transform: translateY(-50%) scale(0.95);
}

.add-btn {
  background: linear-gradient(135deg, #c41e3a 0%, #8b0000 100%);
  color: white;
  border: none;
  padding: 16px 32px;
  border-radius: 16px;
  cursor: pointer;
  font-size: 16px;
  font-weight: 600;
  box-shadow: 0 8px 24px rgba(196, 30, 58, 0.3);
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  width: 100%;
  -webkit-tap-highlight-color: transparent;
}

.add-btn:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 12px 32px rgba(196, 30, 58, 0.4);
}

.add-btn:active:not(:disabled) {
  transform: translateY(0);
}

.add-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.note {
  font-size: 13px;
  color: #666;
  margin-top: 20px;
  padding: 16px;
  background: linear-gradient(135deg, #f8f9fa 0%, #f0f1f3 100%);
  border-radius: 12px;
  border-left: 4px solid #2f6f4e;
  line-height: 1.6;
}

@media (max-width: 768px) {
  body {
    padding: 20px 12px;
  }
  
  .santa {
    width: 80px;
    height: 80px;
  }
  
  .title-box {
    padding: 24px 20px;
  }
  
  h1 {
    font-size: 26px;
  }
  
  .subtitle {
    font-size: 14px;
  }
  
  .card {
    padding: 20px;
  }
  
  th, td {
    padding: 12px;
    font-size: 14px;
  }
  
  .add-btn {
    padding: 14px 24px;
    font-size: 15px;
  }
}
</style>
</head>

<body>

<div class="container">
  <div class="header-section">
    <div class="santa-container">
      <svg class="santa" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
        <!-- Santa Hat -->
        <path d="M60 80 L100 20 L140 80 Z" fill="#c41e3a"/>
        <ellipse cx="100" cy="82" rx="45" ry="8" fill="#fff"/>
        <circle cx="100" cy="20" r="12" fill="#fff"/>
        
        <!-- Face -->
        <ellipse cx="100" cy="110" rx="40" ry="45" fill="#ffd7ba"/>
        
        <!-- Eyes -->
        <circle cx="90" cy="105" r="4" fill="#333"/>
        <circle cx="110" cy="105" r="4" fill="#333"/>
        <circle cx="91" cy="104" r="2" fill="#fff"/>
        <circle cx="111" cy="104" r="2" fill="#fff"/>
        
        <!-- Nose -->
        <circle cx="100" cy="115" r="6" fill="#ff6b6b"/>
        
        <!-- Mustache -->
        <ellipse cx="85" cy="125" rx="18" ry="8" fill="#fff"/>
        <ellipse cx="115" cy="125" rx="18" ry="8" fill="#fff"/>
        
        <!-- Beard -->
        <path d="M70 135 Q100 165 130 135 L130 155 Q100 175 70 155 Z" fill="#fff"/>
        
        <!-- Body -->
        <rect x="75" y="155" width="50" height="40" rx="8" fill="#c41e3a"/>
        <rect x="78" y="158" width="44" height="15" fill="#fff"/>
        
        <!-- Arms -->
        <rect x="55" y="165" width="20" height="12" rx="6" fill="#c41e3a"/>
        <rect x="125" y="165" width="20" height="12" rx="6" fill="#c41e3a"/>
        
        <!-- Hands -->
        <circle cx="55" cy="171" r="8" fill="#ffd7ba"/>
        <circle cx="145" cy="171" r="8" fill="#ffd7ba"/>
      </svg>
    </div>
    
    <div class="title-box">
      <div class="lights-container">
        <div class="light"></div>
        <div class="light"></div>
        <div class="light"></div>
        <div class="light"></div>
      </div>
      <h1>üéÖ Secret Santa Delivery List</h1>
      <p class="subtitle">Add your delivery information for your Secret Santa gift! üéÅ</p>
    </div>
  </div>

  <div class="locked-banner" id="lockedBanner">
    üò¥ Santa is asleep! Editing is locked until next year.
  </div>

  <div class="card">
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>üéÖ NAME</th>
            <th>üè† DELIVERY ADDRESS</th>
            <th>üìû PHONE</th>
          </tr>
        </thead>
        <tbody id="rows"></tbody>
      </table>
    </div>

    <button class="add-btn" id="addBtn" onclick="addRow()">
      <span>‚ú®</span>
      <span>Add Your Information</span>
    </button>
    
    <div class="note">
      üéÑ <strong>Ho ho ho!</strong> Santa is watching. You can only delete your own entries. Be kind and respectful!
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
// Create gentle snowfall
for(let i = 0; i < 20; i++) {
  const snowflake = document.createElement('div');
  snowflake.className = 'snowflake';
  snowflake.innerHTML = '‚ùÑ';
  snowflake.style.left = Math.random() * 100 + '%';
  snowflake.style.animationDuration = (Math.random() * 10 + 15) + 's';
  snowflake.style.animationDelay = Math.random() * 10 + 's';
  snowflake.style.fontSize = (Math.random() * 6 + 10) + 'px';
  document.body.appendChild(snowflake);
}

// Get or create persistent browser ID
function getBrowserId() {
  let id = localStorage.getItem('santa_browser_id');
  if (!id) {
    id = 'user_' + Math.random().toString(36).substr(2, 9) + Date.now();
    localStorage.setItem('santa_browser_id', id);
  }
  return id;
}

const BROWSER_ID = getBrowserId();

// Deadline configuration (Christmas Eve 2024)
const DEADLINE = new Date('2025-12-31T23:59:59');

function isLocked() {
  return new Date() > DEADLINE;
}

function updateLockStatus() {
  const locked = isLocked();
  const banner = document.getElementById('lockedBanner');
  const addBtn = document.getElementById('addBtn');
  
  if (locked) {
    banner.classList.add('active');
    addBtn.disabled = true;
  }
}
</script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, collection, addDoc,
  onSnapshot, doc, updateDoc, deleteDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDEJN32kWnQAhktwn4d6sSfDrGFAokF_I8",
  authDomain: "secret-santa-7eb76.firebaseapp.com",
  projectId: "secret-santa-7eb76",
  storageBucket: "secret-santa-7eb76.firebasestorage.app",
  messagingSenderId: "404557846756",
  appId: "1:404557846756:web:5f5c643628efb52bc8f4f1",
  measurementId: "G-K2BPV8TDQ9"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const rowsEl = document.getElementById("rows");

// Check lock status on load
updateLockStatus();

onSnapshot(collection(db, "addresses"), snap => {
  rowsEl.innerHTML = "";
  snap.forEach(d => renderRow(d.id, d.data()));
  
  // Animate rows in
  anime({
    targets: '#rows tr',
    opacity: [0, 1],
    translateY: [20, 0],
    delay: anime.stagger(50),
    duration: 400,
    easing: 'easeOutQuad'
  });
});

function renderRow(id, data) {
  const tr = document.createElement("tr");
  const isOwner = data.ownerId === BROWSER_ID;
  const locked = isLocked();
  
  ["name","address","phone"].forEach(field => {
    const td = document.createElement("td");
    td.contentEditable = !locked;
    td.innerText = data[field] || "";
    
    if (!locked) {
      td.onblur = () => {
        anime({
          targets: td,
          scale: [0.98, 1],
          duration: 200,
          easing: 'easeOutQuad'
        });
        updateDoc(doc(db,"addresses",id), { [field]: td.innerText });
      };
      
      td.onfocus = () => {
        anime({
          targets: td,
          scale: [1, 1.02],
          duration: 200,
          easing: 'easeOutQuad'
        });
      };
    }
    
    tr.appendChild(td);
  });
  
  // Add delete button only for owner
  if (isOwner && !locked) {
    const lastTd = tr.lastChild;
    const deleteBtn = document.createElement("button");
    deleteBtn.className = "delete-btn";
    deleteBtn.innerHTML = "√ó";
    deleteBtn.onclick = async (e) => {
      e.stopPropagation();
      
      if (confirm("Are you sure you want to delete this entry?")) {
        anime({
          targets: tr,
          opacity: [1, 0],
          translateX: [0, 50],
          duration: 300,
          easing: 'easeInQuad',
          complete: async () => {
            await deleteDoc(doc(db, "addresses", id));
          }
        });
      }
    };
    lastTd.appendChild(deleteBtn);
  }

  rowsEl.appendChild(tr);
}

window.addRow = async () => {
  if (isLocked()) return;
  
  await addDoc(collection(db,"addresses"), {
    name: "",
    address: "",
    phone: "",
    ownerId: BROWSER_ID,
    createdAt: new Date().toISOString()
  });
  
  // Celebration confetti
  confetti({
    particleCount: 100,
    spread: 70,
    origin: { y: 0.6 },
    colors: ['#c41e3a', '#2f6f4e', '#ffd700']
  });
  
  // Animate button
  anime({
    targets: '#addBtn',
    scale: [1, 0.95, 1],
    duration: 300,
    easing: 'easeOutQuad'
  });
};
</script>

</body>
</html>